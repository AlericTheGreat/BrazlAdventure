define(["require","exports","tslib","external/lodash","external/react","modules/clean/react/css","spectrum_comments/comment_stream","modules/clean/react/comments2/helper","modules/clean/react/comments2/store/selectors","modules/clean/react/comments2/store/types","modules/clean/react/file_sidebar/file_sidebar_connect","modules/clean/react/comments2/store/actions","modules/clean/react/file_viewer/coach_mark","modules/clean/react/file_viewer/more_dropdown/more_option_registry","modules/clean/react/file_action_button","modules/clean/react/file_viewer/more_dropdown/models","modules/clean/previews/constants","modules/clean/video_annotations_prototype/video_annotation_prototype_helper","spectrum_comments/comment/video_comment","spectrum_comments/comment_editor/comment_editor","spectrum_comments/comment_editor/video_comment_editor","modules/clean/video_annotations_prototype/constants","modules/clean/video_annotations_prototype/video_preview_event_emitter","modules/clean/react/comments2/logger","modules/core/i18n"],function(e,t,o,n,r,i,a,s,d,m,c,p,l,u,v,h,_,C,f,T,E,g,y,w,O){"use strict";function b(e){var t=e.playerCurrentTime,n=e.previewType,i=e.onboardingResult,a=e.onCoachmarkClose;if(n===_.PreviewType.Video&&void 0!==t){var s=!!i&&!i.initial_video_land;return r.createElement(E.VideoCommentEditor,o.__assign({},e,{currentTime:t,showCoachmark:s,createCoachmark:function(){return r.createElement(l.CoachMark,{title:O._("Target your feedback"),arrowPosition:"top",showClose:!0,onCloseButtonClick:a},O._("Adding time codes to comments keeps feedback simple, organized, and all in one place"))}}))}return r.createElement(T.CommentEditor,o.__assign({},e))}function S(e){return{mentions:d.getMentionsData(e),playerCurrentTime:d.getPlayerCurrentTime(e),onboardingResult:d.getOnboardingResult(e),showResolved:d.getShowResolved(e),threads:d.getThreads(e),activeThreadId:d.getActivatedThreadId(e)}}Object.defineProperty(t,"__esModule",{value:!0});var M=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.videoPreviewOnboardingDismissed=function(){var e=t.props,o=e.viewer;(0,e.dispatch)(p.markHasOnboarded(o.id,"video_first_paused"))},t.toggleShowResolved=function(){var e=t.props,o=e.dispatch,n=e.showResolved,r=e.viewer,i=e.stream,a=n?"hide_resolved_threads":"show_resolved_threads";o(p.toggleShowResolved()),w.commentLogger.logEvent(r.id,a,i)},t.createEditor=function(e){return b(o.__assign({},e,n.pick(t.props,["onboardingResult","playerCurrentTime","previewType"]),{onCoachmarkClose:t.onCoachmarkClose}))},t.onCoachmarkClose=function(){var e=t.props,o=e.dispatch,n=e.viewer.id;o(p.markHasOnboarded(n,"initial_video_land"))},t}return o.__extends(t,e),t.prototype.updateCommentsMoreOptionGroup=function(){var e=this.props.showResolved?v.FileActionButtonType.HIDE_RESOLVED_COMMENTS:v.FileActionButtonType.SHOW_RESOLVED_COMMENTS,t=new h.MoreOptionGroup({fileActionButtonGroup:v.FileActionButtonGroup.COMMENTS,options:[new h.MoreOption({className:"comments-options-item__show-resolved",fileActionButtonType:e,component:function(e){return r.createElement("span",null,e.buttonText)},handler:this.toggleShowResolved})]});void 0===this.moreOptionGroup?u.moreOptionRegistry.addOption(t):u.moreOptionRegistry.replaceOption(this.moreOptionGroup,t),this.moreOptionGroup=t},t.prototype.componentWillMount=function(){var e=this.props,t=e.viewer;(0,e.dispatch)(p.initializeMentionsContacts(t))},t.prototype.componentDidMount=function(){this.updateCommentsMoreOptionGroup(),y.videoPreviewEventEmitter.addListener(g.EventTypes.ONBOARDING_DISMISSED,this.videoPreviewOnboardingDismissed)},t.prototype.componentDidUpdate=function(){this.updateCommentsMoreOptionGroup()},t.prototype.componentWillUnmount=function(){y.videoPreviewEventEmitter.removeListener(g.EventTypes.ONBOARDING_DISMISSED,this.videoPreviewOnboardingDismissed)},Object.defineProperty(t.prototype,"actionsAdapter",{get:function(){var e=this.props,t=e.dispatch,n=e.mentions,r=e.stream,i=e.viewer;return{onClickTimeCode:function(e){var t=C.VideoAnnotationPrototypeHelper.unitConvertDomainObjectTimeToSeconds(e);y.videoPreviewEventEmitter.emit(g.EventTypes.SEEK_POSITION_AND_PAUSE,t)},onEditorFocused:function(e){y.videoPreviewEventEmitter.emit(g.EventTypes.PAUSE)},onThreadActivated:function(e){if(t(p.activateThread(e)),e.read||t(p.markThreadRead(i,r,e.id,m.MarkThreadReadOrigin.ThreadActivated)),e.annotation){var o=C.VideoAnnotationPrototypeHelper.unitConvertDomainObjectTimeToSeconds(e.annotation.time);y.videoPreviewEventEmitter.emit(g.EventTypes.SEEK_POSITION_AND_PAUSE,o)}},onThreadCreated:function(e,n){var a=s.Comments2Helper.commentContentToUserSubmittedComment(e,r);n&&(a.annotation_data=o.__assign({".tag":"video"},n)),t(p.addComment(i,r,a))},onThreadRepliedTo:function(e,o){var n=s.Comments2Helper.commentContentToUserSubmittedComment(o,r);t(p.addComment(i,r,n,e))},onThreadMarkedAsRead:function(e){t(p.markThreadRead(i,r,e,m.MarkThreadReadOrigin.UIButtonClicked))},onThreadMarkedAsUnread:function(e){t(p.markThreadUnread(i,r,e))},onThreadResolved:function(e){t(p.markThreadResolved(i,r,e))},onThreadUnresolved:function(e){t(p.markThreadUnresolved(i,r,e))},onCommentEdited:function(e,o){var n=s.Comments2Helper.commentContentToUserSubmittedComment(o,r);t(p.editComment(i,r,e,n))},onCommentDeleted:function(e){t(p.deleteComment(i,r,e))},onMentionsQueryUpdated:function(e){var o=function(o){t(p.mentionsMatchesUpdate(e,o))};n.contactsManager.search(e,o,o)}}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"commentComponent",{get:function(){return this.props.previewType===_.PreviewType.Video?f.VideoComment:void 0},enumerable:!0,configurable:!0}),t.prototype.render=function(){var e=this.props,t=e.showResolved,o=e.stream,n=e.viewer,i=e.mentions,s=e.activeThreadId;if(!i.contactsManager)return null;var d=this.props.threads.filter(function(e){return t||!e.resolved});return r.createElement("div",null,r.createElement(a.CommentStream,{id:o.id,actionsAdapter:this.actionsAdapter,commentComponent:this.commentComponent,editorComponent:this.createEditor,enabled:!0,mentionsMatches:i.matches,settings:{canAnnotate:!0,canComment:!0,canRead:!0},userPermissions:{canAnnotate:!0,canComment:!0,canRead:!0},threads:d,user:{id:n.account_id,name:{display:n.display_name,initials:n.fname[0]+n.lname[0]},photoUrl:n.photo_circle_url},initialActiveThreadID:s}))},t})(r.Component);t.UnconnectedCommentsPane=M;var R=i(c.fileSidebarConnect(S)(M),["/static/js/spectrum_comments/index.web-vflf3_aPn.css"]);t.CommentsPane=R});
//# sourceMappingURL=comments_pane.min.js-vflk8nDiY.map